<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<section class="header">
  <a href="/" class="logo">FTI</a>
  <nav class="navbar">
    <a href="/">Home</a>
    <a class="fungs" onclick="toggleMenuMenu()"
      >Menu<i class="bx bxs-chevron-down"></i
    ></a>
    <div class="sub-fungs-wrap" id="subFungs">
      <div class="sub-fungs">
        <div class="fungsi">
          <a href="/publish" class="sub-fungs-links"
            ><p>Berita</p>
            <span>></span></a
          >
          <hr />
          <a href="/himp" class="sub-fungs-links"
            ><p>Organisasi</p>
            <span>></span></a
          >
          <hr />
          <a href="/kgt" class="sub-fungs-links"
            ><p>Riwayat Kegiatan</p>
            <span>></span></a
          >
        </div>
      </div>
    </div>
    <a class="daftar" onclick="toggleMenuDaftar()"
      >Pengajuan<i class="bx bxs-chevron-down"></i
    ></a>
    <div class="sub-daftar-wrap" id="subDaftar">
      <div class="sub-daftar">
        <div class="pendaftaran">
          <a href="/dafkgt" class="sub-daftar-links"
            ><p>Pengajuan Kegiatan</p>
            <span>></span></a
          >
          <hr />
          <a href="/dafnews" class="sub-daftar-links"
            ><p>Pengajuan Publikasi</p>
            <span>></span></a
          >
          <hr />
          <a href="/lapor" class="sub-daftar-links"
            ><p>Laporan Kegiatan</p>
            <span>></span></a
          >
        </div>
      </div>
    </div>
  </nav>
  <nav class="add">
    <div class="notification-icon">
      <i class="bx bx-bell" onclick="toggleDropdown()"></i>
      <div id="notificationDropdown" class="dropdown-content">
        <h1>Notifikasi</h1>
        <hr />
        <% if (notifs.length > 0 ) { %> <% notifs.forEach((notifs) => { %>
        <div class="isian">
          <h3 class="judul">
            <%= notifs.judul %> <span><%= formatDate(notifs.tanggal) %></span>
          </h3>
          <p class="isi"><%= notifs.isi %></p>
          <hr />
        </div>
        <% }) %> <% } else { %>
        <p>Belum ada notifikasi</p>
        <% } %>
      </div>
    </div>
    <img src="/img/fti.jpg" class="user-pic" onclick="toggleMenu()" />
    <div class="sub-menu-wrap" id="subMenu">
      <div class="sub-menu">
        <div class="user-info">
          <h3>Welcome</h3>
        </div>
        <hr />
        <a href="/orga" class="sub-menu-links"
          ><p>Profile</p>
          <span>></span></a
        >
        <hr />
        <form action="/logout" method="post" id="logoutForm">
          <button type="submit" id="logoutBtn" class="logut">
            <i class="bx bxs-log-out"></i> <span>Logout</span>
          </button>
        </form>
      </div>
    </div>
  </nav>

  <script>
    function toggleDropdown() {
      const dropdown = document.getElementById("notificationDropdown");
      if (dropdown) {
        console.log("Dropdown found, toggling visibility");
        dropdown.classList.toggle("show");
      } else {
        console.log("Dropdown not found");
      }
    }

    window.onclick = function (event) {
      if (!event.target.matches(".bx-bell")) {
        const dropdowns = document.getElementsByClassName("dropdown-content");
        for (let i = 0; i < dropdowns.length; i++) {
          const openDropdown = dropdowns[i];
          if (openDropdown.classList.contains("show")) {
            openDropdown.classList.remove("show");
          }
        }
      }
    };
  </script>

  <script>
    let subMenu = document.getElementById("subMenu");
    function toggleMenu() {
      subMenu.classList.toggle("open-menu");
    }
    let subDaftar = document.getElementById("subDaftar");
    function toggleMenuDaftar() {
      subDaftar.classList.toggle("open-daftar");
    }
    let subNotif = document.getElementById("subNotif");
    function toggleMenuNotif() {
      subDaftar.classList.toggle("open-notif");
    }
    let subFungs = document.getElementById("subFungs");
    function toggleMenuMenu() {
      subFungs.classList.toggle("open-fungs");
    }
  </script>
  <script>
    document
      .getElementById("logoutBtn")
      .addEventListener("click", function (event) {
        event.preventDefault();
        Swal.fire({
          title: "Mau Logout?",
          text: "Kamu Yakin Mau Ninggalin Aku? ðŸ¥º",
          icon: "question",
          showCancelButton: true,
          confirmButtonText: "Ya",
          cancelButtonText: "Tidak",
        }).then((result) => {
          if (result.isConfirmed) {
            Swal.fire({
              title: "Berhasil Logout!",
              text: "Jangan Lupa Mampir Lagi ya...",
              icon: "success",
              confirmButtonText: "OK",
            }).then((result) => {
              if (result.isConfirmed) {
                document.getElementById("logoutForm").submit();
              }
            });
          }
        });
      });
  </script>
</section>
